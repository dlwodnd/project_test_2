<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.hoteldog.user.UserMapper">
    <insert id="userSignup" useGeneratedKeys="true" keyProperty="userPk">
        INSERT INTO t_user
        SET user_type_pk = #{userTypePk}
        , user_email = #{userEmail}
        , upw = #{upw}
        , nickname = #{nickname}
        , phone_num = #{phoneNum}
        , user_address = #{userAddress}
    </insert>
    <insert id="insUserAddress">
        INSERT INTO t_user_address
        SET user_pk = #{userPK}
            ,address_name = #{addressName}
            ,region_1depth_name = #{region1depthName}
            ,region_2depth_name = #{region2depthName}
            ,region_3depth_name = #{region3depthName}
            ,zone_no = #{zoneNo}
            ,x = #{x}
            ,y = #{y}
            ,detail = #{detail}
    </insert>
    <select id="userPw">
        SELECT upw
        FROM t_user
        WHERE user_email = #{userEmail}
    </select>
    <select id="userEntityByUserEmail">
        SELECT user_pk AS userPk
        , user_type_pk AS userTypePk
        , user_email AS userEmail
        , upw
        , nickname
        , phone_num AS phoneNum
        , user_address AS userAddress
        FROM t_user
        WHERE user_email = #{userEmail}
    </select>
    <select id="userEntityByUserPk">
        SELECT user_pk AS userPk
        , user_type_pk AS userTypePk
        , user_email AS userEmail
        , upw
        , nickname
        , phone_num AS phoneNum
        , user_address AS userAddress
        FROM t_user
        WHERE user_pk = #{userPk}
    </select>
    <select id="selUserEntity">
        SELECT user_pk AS userPk
        ,user_type_pk AS userTypePk
        ,user_email AS userEmail
        ,upw ,nickname
        ,phone_num AS phoneNum
        ,user_address AS userAddress
        FROM t_user
    </select>
    <select id="selUserDogSize">
        SELECT DISTINCT size_pk
        FROM t_user_dog
        WHERE user_pk = #{userPK}
    </select>
    <select id="selUserDepthName">
        SELECT region_1depth_name
        FROM t_user_address
        WHERE user_pk = #{userPk}
    </select>
    <update id="updateUserInfo">
        UPDATE t_user A
        JOIN t_user_address B
        ON A.user_pk = B.user_pk
        SET A.nickname = #{nickname}
        ,A.phone_num = #{phoneNum}
        ,A.user_address = #{userAddress}
        ,B.address_name = #{addressName}
        ,B.region_1depth_name = #{region1depthName}
        ,B.region_2depth_name = #{region2depthName}
        ,B.region_3depth_name = #{region3depthName}
        ,B.zone_no = #{zoneNo}
        ,B.x = #{x}
        ,B.y = #{y}
        ,B.detail = #{detail}
        WHERE A.user_pk = #{userPk}
    </update>
</mapper>